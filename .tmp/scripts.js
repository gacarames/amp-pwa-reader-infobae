class HistoryStack{constructor(e){this.backend=e,this.state=history.state&&history.state.category?history.state:this.parseUrlIntoState(),this.backend.categories[this.state.category]||(this.state.category=this.backend.defaultCategory,history.replaceState({category:this.state.category},"",this.constructUrl()))}constructUrl(e){return"/"+this.backend.appTitle.toLowerCase()+"/"+(window.shadowReader&&shadowReader.nav.category||this.state.category)+(e?"/"+this.backend.getAMPUrlComponent(e):"")}parseUrlIntoState(){var e=location.pathname.replace(/^\/*/,"").replace(/\/*$/,"").replace(this.backend.appTitle.toLowerCase()+"/",""),t={category:this.backend.defaultCategory,articleUrl:null};return this.backend.getCategoryTitle(e)?t.category=e:e&&(t.category=e.split("/")[0],t.articleUrl=this.backend.constructAMPUrl(t.category,e.substr(t.category.length+1))),t}setDocTitle(e){document.title="ShadowReader – "+shadowReader.nav.categoryTitle+(e?" – "+e:"")}navigate(e,t,s){this.setDocTitle(s);var i=this.constructUrl(e);i!==document.location.pathname?history.pushState({category:shadowReader.nav.category,articleUrl:e},"",i):t&&history.replaceState({category:shadowReader.nav.category,articleUrl:e},"",i)}}class Backend{constructor(){this.appTitle="infobae",this.ampEndpoint="https://www.infobae.com/",this.defaultCategory="us",this.categories={"":"Noticias","deportes-2":"Deportes",politica:"Política",economia:"Economia",sociedad:"Sociedad",tecnologia:"Tecnología",tendencias:"Tendencias",teleshow:"Teleshow"}}getCategoryTitle(e){return this.categories[e]}getRSSUrl(e){return"https://www.infobae.com/feeds/rss/sites/"+e}getRSSTitle(e){return e.title}getRSSImage(e){return e.thumbnail}getRSSDescription(e){return e.description}getAMPUrl(e){return e+"?outputType=amp-type"}constructAMPUrl(e,t){return this.ampEndpoint+t}getAMPUrlComponent(e){return e.replace(this.ampEndpoint,"")}getArticleData(){return{description:this._description,title:this._title,image:this._image,imageRatio:this._imageRatio}}extractSchemaData(e){var t=e.querySelectorAll('script[type="application/ld+json"]');for(let s of t){let e=JSON.parse(s.textContent);if(/WebPage|NewsArticle/.test(e["@type"]))return e}return null}sanitize(e){e.querySelector("section#top").remove();let t=e.getElementsByTagName("header");t.length&&t[0].remove();let s=e.getElementsByTagName("amp-sidebar");s.length&&s[0].remove();let i=e.querySelector("header.content__head");i&&(this._title=i.querySelector("h1.content__headline").textContent,this._description=i.querySelector(".content__standfirst meta").getAttribute("content"),i.remove());let r=e.querySelector(".media-primary amp-img");r&&(this._image=r.getAttribute("src"),this._imageRatio=r.getAttribute("height")/r.getAttribute("width"),r.remove())}}class Evented{constructor(){this._events={}}bind(e,t){return this._events[e]=this._events[e]||[],this._events[e].push(t),this}unbind(e,t){this._events[e]=this._events[e]||[];let s=this._events[e].indexOf(t);return s>-1&&this._events[e].splice(s,1),this}trigger(e,t,s,i,r,a,n,o,h){this._events[e]=this._events[e]||[];for(let l=0;l<this._events[e].length;l++)this._events[e][l](t,s,i,r,a,n,o,h);return this}}class DragObserver extends Evented{constructor(e,t={}){super(),this._started=!1,this.element=e,this.axis=t.axis||"both",this.distance=t.distance||10,this._clickPreventer=this._createClickPreventer(),this._supportsPointerEvents=!!window.PointerEvent,this.element.addEventListener(this._supportsPointerEvents?"pointerdown":"touchstart",this._start.bind(this),{passive:!0})}_createClickPreventer(){var e=document.createElement("div");return e.style.width="30px",e.style.height="30px",e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.zIndex="1000",e}_calculateOffset(e){var t=0,s=0;do{t+=e.offsetLeft,s+=e.offsetTop}while(e=e.offsetParent);return{x:t,y:s}}_meetsDistance(e){return"both"===this.axis&&(Math.abs(e.x)>=this.distance||Math.abs(e.y)>=this.distance)||"x"===this.axis&&Math.abs(e.x)>=this.distance||"y"===this.axis&&Math.abs(e.y)>=this.distance}_start(e){e.pageX&&(this.eventDown=e),this.__move=(e=>this._move(e)),this.__stop=(e=>this._stop(e)),document.addEventListener(this._supportsPointerEvents?"pointermove":"touchmove",this.__move,{passive:!0}),document.addEventListener(this._supportsPointerEvents?"pointerup":"touchend",this.__stop,{passive:!0})}_move(e){e.pageX&&(this.eventMove=e),this.eventMovePrev=this.eventMove||this.eventStart,this.eventMove=e;let t={x:-(this.eventDown.pageX-this.eventMove.pageX),y:-(this.eventDown.pageY-this.eventMove.pageY)},s={x:"both"===this.axis||"x"===this.axis?t.x:0,y:"both"===this.axis||"y"===this.axis?t.y:0};this._meetsDistance(s)&&!this._started&&(this._started=!0,document.body.appendChild(this._clickPreventer),this.trigger("start",s)),this._started&&(this._clickPreventer.style.transform="translate3d("+(this.eventDown.pageX+t.x-15)+"px, "+(this.eventDown.pageY+t.y-15)+"px, 0)",this.trigger("move",s))}_stop(e){document.removeEventListener(this._supportsPointerEvents?"pointermove":"touchmove",this.__move),document.removeEventListener(this._supportsPointerEvents?"pointerup":"touchend",this.__stop),this._started&&(e.stopPropagation(),this._clickPreventer.remove(),this._started=!1,this.trigger("stop"))}}class ShadowReader{constructor(){this.backend=new Backend,this.history=new HistoryStack(this.backend),this.clickEvent="click"}init(){this.itemsElement=document.querySelector("main"),this.headerElement=document.querySelector("header"),this.hamburgerElement=document.querySelector(".sr-hamburger"),this.nav=new Nav}ampReady(e){(window.AMP=window.AMP||[]).push(e)}enableCardTabbing(){let e=Array.from(this.itemsElement.children);for(let t of e)t.children[1].removeAttribute("tabindex")}disableCardTabbing(){let e=Array.from(this.itemsElement.children);for(let t of e)t.children[1].setAttribute("tabindex",-1)}focusVisibleCard(){if(!this.nav||!this.nav.cards)return;const e=window.scrollY,t=window.innerHeight;for(let s of this.nav.cards)if(s.elem.offsetTop<e+t&&s.elem.offsetTop>e){s.innerElem.focus();break}}}window.shadowReader=new ShadowReader,document.addEventListener("DOMContentLoaded",function(){shadowReader.init(),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js")});class FeedReader{constructor(){}fetch(e,t=0){let s=shadowReader.backend.getRSSUrl(e),i=encodeURIComponent(s);return fetch("https://api.rss2json.com/v1/api.json?rss_url="+i+"&count=60").then(e=>e.json()).then(s=>{return!s.items&&t<10?this.fetch(e,(t||0)+1):(s.items?s.items:[]).map(e=>({title:shadowReader.backend.getRSSTitle(e),description:shadowReader.backend.getRSSDescription(e),link:e.link,image:shadowReader.backend.getRSSImage(e)}))})}}class Nav{constructor(){this.category=null,this.cards=[],this.feedReader=new FeedReader,this.element=document.querySelector(".sr-navigation"),this.bind(),this.initMenuSlide(),this.create();var e=shadowReader.history.state;e.articleUrl?shadowReader.ampReady(()=>{this.startWithArticle(e)}):this.switchCategory(e.category)}clear(){this.element.innerHTML=""}create(){let e=document.createDocumentFragment();for(let t in shadowReader.backend.categories){let s=document.createElement("li"),i=document.createElement("a");i.href="#",i.dataset.tag=t,i.textContent=shadowReader.backend.categories[t],s.appendChild(i),e.appendChild(s)}this.element.appendChild(e)}initMenuSlide(){const e=document.querySelector(".sr-navigation-skirt");var t=!1,s=0;this.dragObserver=new DragObserver(document,{axis:"x"}),this.dragObserver.bind("start",()=>{t=document.body.classList.contains("sr-nav-shown"),this.element.classList.add("sr-disable-transitions")}),this.dragObserver.bind("move",i=>{s=i.x;let r=t?0:200,a=Math.max(-200,Math.min(i.x,r)-r);this.element.style.transform="translateX("+a+"px)",e.style.opacity=1-a/-200}),this.dragObserver.bind("stop",()=>{this.element.classList.remove("sr-disable-transitions"),this.element.style.transform="",e.style.opacity="",Math.abs(s)>70&&this[t?"hide":"show"]()})}startWithArticle(e){let t=Article.getArticleByURL(e.articleUrl)||new Article(e.articleUrl);if(t.card)return t.card.activate();t.load().then(()=>t.render()).then(()=>{t.container.classList.add("sr-disable-transitions"),t.show(!0).then(()=>{setTimeout(()=>{document.body.classList.remove("sr-skeleton-ui-article"),t.container.classList.remove("sr-disable-transitions")},100)}),this.hamburgerReturnAction=(()=>{shadowReader.enableCardTabbing(),t.card&&t.card.animateBack(),t.hide(),shadowReader.history.navigate(null)}),this.switchCategory(e.category).then(()=>{for(let e of this.cards)e.article.url===t.url&&e.ready(()=>{t.card=e,e.article=t,t._mainScrollY=Math.max(0,e.elem.offsetTop-innerHeight/3),t.card.animate(!1,-t._mainScrollY)});shadowReader.disableCardTabbing()})})}setOpenArticle(e,t){this.openArticle=e,shadowReader.history.navigate(e.url,t,e.ampDoc.title)}getNavElement(e){return document.querySelector('.sr-navigation a[data-tag="'+e+'"]')}setNavElement(e){if(this.category){let e=this.getNavElement(this.category);e&&e.parentNode.classList.remove("active")}this.getNavElement(e).parentNode.classList.add("active"),document.querySelector(".sr-category span").textContent=this.categoryTitle}switchCategory(e){this.categoryTitle=shadowReader.backend.getCategoryTitle(e),this.setNavElement(e),this.category=e;for(let t of this.cards)t.elem.classList.add("sr-loading");return this.hide(),this.feedReader.fetch(e).then(e=>{if(this._cardViewInitialized||(document.body.classList.remove("sr-skeleton-ui"),this._cardViewInitialized=!0),!e.length)return void console.error("feed failed to update!");shadowReader.itemsElement.innerHTML="",this.cards=[];let t=3;for(let s of e)this.cards.push(new Card(s,!1,--t>=0));document.scrollingElement.scrollTop=0,shadowReader.itemsElement.firstElementChild.children[1].focus()})}show(){let e=Array.from(this.element.children);for(let t of e)t.firstChild.removeAttribute("tabindex");this.element.children[0].firstChild.focus(),document.body.classList.add("sr-nav-shown")}hide(){const e=Array.from(this.element.children);for(let t of e)t.firstChild.setAttribute("tabindex","-1");shadowReader.focusVisibleCard(),document.body.classList.remove("sr-nav-shown")}toggle(){return this[document.body.classList.contains("sr-nav-shown")?"hide":"show"]()}resize(){for(let e of this.cards)e.refresh()}bind(){let e;window.addEventListener("popstate",e=>{let t={category:e.state&&e.state.category?e.state.category:this.category,articleUrl:e.state?e.state.articleUrl:null};this.category!==t.category&&this.switchCategory(t.category),this.openArticle&&!t.articleUrl&&this.hamburgerReturnAction&&(this.hamburgerReturnAction(),this.hamburgerReturnAction=null,this.openArticle=null),t.articleUrl&&this.startWithArticle(t)},!1),document.querySelector(".sr-hamburger").addEventListener(shadowReader.clickEvent,e=>{!document.documentElement.classList.contains("sr-article-shown")&&this.toggle(),this.hamburgerReturnAction&&(this.hamburgerReturnAction(e),this.hamburgerReturnAction=null)}),document.querySelector(".sr-navigation").addEventListener(shadowReader.clickEvent,e=>{"A"===e.target.nodeName&&(this.switchCategory(e.target.dataset.tag,e.target.parentNode),shadowReader.history.navigate(null),e.preventDefault())}),document.querySelector(".sr-navigation-skirt").addEventListener(shadowReader.clickEvent,()=>{this.hide()}),window.addEventListener("resize",()=>{clearTimeout(e),e=setTimeout(()=>{this.resize()},100)})}}class Card{constructor(e,t,s){this.data=e,this.headless=t,this.currentTransform={scaleX:1,scaleY:1},this.naturalDimensions={width:0,height:0},this.create(),this.bind(),this.headless?(this.elem.classList.add("sr-full"),this.innerElem.setAttribute("tabindex",-1)):(this.article=new Article(this.data.link,this),this.render()),s&&this.article.load()}resizeChildren(e,t,s){let i=this.imageData.width,r=this.imageData.height,a=e.width,n=e.height,o=n/r,h=a/i,l=h>o,c="translateX("+-(i*o-a)/2+"px)",d="translateY("+-(r*h-n)/2+"px)";if(!1===t&&this.elem.classList.add("sr-disable-transitions"),this.img.style.transform=(l?d:c)+"scaleY("+1/this.currentTransform.scaleY+")scaleX("+(l?h:o)+")scaleY("+(l?h:o)+")scaleX("+1/this.currentTransform.scaleX+")scale(var(--hover-scale))",this.innerElem.style.transform="scaleX("+1/this.currentTransform.scaleX+")scaleY("+1/this.currentTransform.scaleY+")",!this.elem.matches(".sr-card:first-child")&&s){let e=this.elem.children[1].children[1];this.innerElem.style.transform+=" translateY(-"+(e.offsetHeight+16)+"px)"}!1===t&&setTimeout(()=>{this.elem.classList.remove("sr-disable-transitions")},0)}animate(e,t){let s=this.elem;s.classList.add("sr-full");let i=s.offsetLeft+s.offsetParent.offsetLeft,r=s.offsetTop+s.offsetParent.offsetTop-shadowReader.headerElement.offsetHeight-scrollY+(t||0),a=this.naturalDimensions.width,n=this.naturalDimensions.height,o=innerWidth,h=o*this.imageData.ratio;this.currentTransform={scaleX:o/a,scaleY:h/n,translateX:-i,translateY:-r},this.elem.style.transform="translateY("+this.currentTransform.translateY+"px)translateX("+this.currentTransform.translateX+"px)scaleX("+this.currentTransform.scaleX+")scaleY("+this.currentTransform.scaleY+")",this.resizeChildren({width:o,height:h},!e,!0)}animateBack(){this.elem.classList.remove("sr-full"),this.elem.style.transform="",this.currentTransform={scaleX:1,scaleY:1,translateY:0},this.resizeChildren(this.naturalDimensions,!0,!1)}create(){var e=document.createElement("div"),t=document.createElement("a"),s=document.createElement("img"),i=document.createElement("h2"),r=document.createElement("p");i.innerHTML=this.data.title,r.innerHTML=this.data.description,t.className="sr-inner",t.href=this.data.link||"",e.className="sr-card",s.src=this.data.image,s.setAttribute("role","presentation"),this.headless||(s.style.opacity=0,s.onload=(()=>{this.imageData={ratio:s.offsetHeight/s.offsetWidth,width:s.offsetWidth,height:s.offsetHeight},this.naturalDimensions={width:this.elem.offsetWidth,height:this.elem.offsetHeight},this.resizeChildren(this.naturalDimensions,!1),s.style.opacity="",this.setReady()})),t.appendChild(i),t.appendChild(r),e.appendChild(s),e.appendChild(t),this.elem=e,this.img=s,this.innerElem=t}refresh(){this.naturalDimensions={width:this.elem.offsetWidth,height:this.elem.offsetHeight},this.resizeChildren(this.naturalDimensions,!1)}hijackMenuButton(){shadowReader.nav.hamburgerReturnAction=(e=>{e&&history.back(),this.deactivate()})}activate(){shadowReader.disableCardTabbing(),this.elem.classList.add("sr-loading","sr-promote-layer"),this.article.load().then(()=>this.article.render()).then(()=>{this.elem.classList.remove("sr-loading"),this.animate(),this.article.show(),this.hijackMenuButton()}).catch(e=>{this.elem.classList.remove("sr-loading"),this.elem.classList.add("sr-error")})}deactivate(){shadowReader.enableCardTabbing(),this.animateBack(),this.article.hide()}bind(){this.innerElem.addEventListener("click",e=>{innerWidth>=768||(e.preventDefault(),this.innerElem.blur(),this.elem.classList.contains("sr-full")||this.activate())})}render(){shadowReader.itemsElement.appendChild(this.elem)}setReady(){if(this._ready=!0,this._readyQueue){for(let e of this._readyQueue)e();this._readyQueue=[]}}ready(e){this._ready?e():(this._readyQueue=this._readyQueue||[],this._readyQueue.push(e))}}class Article{constructor(e,t){this.url=shadowReader.backend.getAMPUrl(e),this.card=t,Article.articles[this.url]=this}fetch(){var e=new XMLHttpRequest;return new Promise((t,s)=>{e.open("GET","https://seed-octagon.glitch.me/"+encodeURIComponent(this.url),!0),e.responseType="document",e.setRequestHeader("Accept","text/html"),e.onload=(()=>{return e.responseXML.documentElement.hasAttribute("amp")||e.responseXML.documentElement.hasAttribute("⚡")?t(e.responseXML):s("Article does not have an AMP version.")}),e.send()})}load(){return this.doc?Promise.resolve():this.fetch().then(e=>{this.doc=e,this.sanitize()})}clear(){this.ampDoc.close(),this.destroyShadowRoot()}sanitize(){let e=this.doc,t=!!this.card;shadowReader.backend.sanitize(e,t),this.doc.body.classList.add("sr-backend-"+shadowReader.backend.appTitle.toLowerCase());var s=document.createElement("link");s.setAttribute("rel","stylesheet"),s.href="/inline.css",this.doc.body.append(s)}createShadowRoot(){var e=document.createElement("article");return e.classList.add("sr-article"),document.body.appendChild(e),e}destroyShadowRoot(){document.body.removeChild(this.container)}cloneCard(){let e=this.card.elem.cloneNode(!0);return e.style.transform="",e.children[0].style.transform="",e.children[1].style.transform="",e.style.height=innerWidth*this.card.imageData.ratio+"px",e.style.opacity="0",e.style.margin="0",this.clonedCard=e,e}generateCard(){let e=shadowReader.backend.getArticleData(),t=new Card(e,!0).elem;return t.style.height=innerWidth*e.imageRatio+"px",t.style.margin="0",this.clonedCard=t,t}get cssVariables(){if(!this._cssVariables){let e=window.getComputedStyle(document.querySelector("html"));this._cssVariables={animationSpeedIn:1e3*parseFloat(e.getPropertyValue("--animation-speed-in")),animationSpeedOut:1e3*parseFloat(e.getPropertyValue("--animation-speed-in")),easing:e.getPropertyValue("--animation-easing")}}return this._cssVariables}animateIn(){return this.card?new Promise(e=>{let t=()=>{this.container.removeEventListener("transitionend",t),e()};this.container.addEventListener("transitionend",t,!1),this.container.classList.add("at-top")}):Promise.resolve()}animateOut(){return this.card?new Promise(e=>{let t=()=>{this.container.removeEventListener("transitionend",t),e()};this.container.addEventListener("transitionend",t,!1),this.container.classList.remove("at-top")}):Promise.resolve()}render(){return this.container=this.createShadowRoot(),this.ampDoc=AMP.attachShadowDoc(this.container,this.doc,this.url),this.ampDoc.setVisibilityState("prerender"),this.ampDoc.ampdoc.whenReady()}show(e){var t=this.card?this.cloneCard():this.generateCard();return t.lastElementChild.onclick=function(){return!1},this.ampDoc.ampdoc.getBody().prepend(t),this.animateIn().then(()=>(this.card&&(t.style.opacity="1"),document.documentElement.classList.add("sr-article-shown"),this.takeoverScroll(),this.ampDoc.setVisibilityState("visible"),shadowReader.nav.setOpenArticle(this,e),!0))}hide(){document.documentElement.classList.remove("sr-article-shown"),setTimeout(()=>(this.restoreScroll(),this.card&&(this.clonedCard.style.opacity="0"),this.animateOut().then(()=>(this.clear(),!0))),50)}takeoverScroll(){this._mainScrollY=document.scrollingElement.scrollTop,document.scrollingElement.scrollTop=0,this.container.style.transform=""}restoreScroll(){document.scrollingElement.scrollTop=this._mainScrollY}}Article.articles={},Article.getArticleByURL=function(e){return Article.articles[e]};